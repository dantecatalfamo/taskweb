<%= turbo_frame_tag heading do %>
  <div data-controller="heading" data-heading-id-value="<%= heading.id %>" class="pb-2 ps-2 mb-2 rounded-start" style="border-left: 3px solid <%= depth_color(heading.depth) %>">
    <details data-heading-target="details" data-action="heading#toggle">
      <summary>
        <strong>
          <% if heading.state %>
            <span style="color: <%= heading.state.color %>"><%= heading.state.name %></span>
          <% end %>
          <%= heading.title %>
        </strong>
        <small>
          (<%= heading.children.size %>)
        </small>
        <%= link_to '<i class="bi bi-pencil"></i>'.html_safe, edit_heading_path(heading) %>
        <%= link_to '<i class="bi bi-arrows-angle-expand"></i>'.html_safe, heading, target: "_top" %>
        <%= link_to '<i class="bi bi-x-lg"></i>'.html_safe, heading, class: "text-danger", data: { turbo_method: :delete, turbo_confirm: "Delete heading \"#{heading.title}\" and all its sub-headings?" } %>
      </summary>
      <div>
        <% if heading.deadline %>
          <p>
            <strong>Deadline:</strong>
            <%= heading.deadline %>
          </p>
        <% end %>

        <% if heading.scheduled %>
          <p>
            <strong>Scheduled:</strong>
            <%= heading.scheduled %>
          </p>
        <% end %>

        <p style="white-space: pre-wrap"><%= heading.body %></p>
        
        <% heading.children.each do |child| %>
          <%= render child %>
        <% end %>

        <%= form_with(model: Heading.new) do |form| %>
          <%= form.text_field :title, placeholder: '+', style: 'border: none', autocomplete: 'off' %>
          <%= form.hidden_field :parent_id, value: heading.id %>
        <% end %>
      </div>

    </details>

  </div>
<% end %>
